<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Analytics - Templats-Link</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .dashboard {
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .stat-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .events-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .event-item {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #28a745;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .event-item.error {
            border-left-color: #dc3545;
        }
        
        .event-item.warning {
            border-left-color: #ffc107;
        }
        
        .event-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .event-data {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .event-time {
            font-size: 0.8rem;
            color: #999;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.secondary:hover {
            background: #5a6268;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #28a745;
        }
        
        .status-offline {
            background: #dc3545;
        }
        
        .session-info {
            background: #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .session-info h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: white;
            padding: 10px;
            border-radius: 4px;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .info-value {
            font-weight: bold;
            color: #333;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .controls {
                flex-direction: column;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìä Dashboard Analytics</h1>
            <p>Sistema de Analytics Templats-Link v2.0</p>
        </div>

        <div class="dashboard">
            <div class="controls">
                <button class="btn" onclick="refreshData()">üîÑ Atualizar</button>
                <button class="btn secondary" onclick="clearData()">üóëÔ∏è Limpar Dados</button>
                <button class="btn secondary" onclick="exportData()">üì§ Exportar</button>
                <button class="btn secondary" onclick="toggleDebug()">üêõ Debug</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Eventos Capturados</h3>
                    <div class="value" id="totalEvents">0</div>
                </div>
                <div class="stat-card">
                    <h3>Tempo na Sess√£o</h3>
                    <div class="value" id="sessionTime">0s</div>
                </div>
                <div class="stat-card">
                    <h3>Profundidade de Scroll</h3>
                    <div class="value" id="scrollDepth">0%</div>
                </div>
                <div class="stat-card">
                    <h3>Status Analytics</h3>
                    <div class="value">
                        <span class="status-indicator" id="statusIndicator"></span>
                        <span id="statusText">Verificando...</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìã Informa√ß√µes da Sess√£o</h2>
                <div class="session-info">
                    <h3>Dados da Sess√£o Atual</h3>
                    <div class="info-grid" id="sessionInfo">
                        <!-- Dados ser√£o preenchidos via JavaScript -->
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìà Eventos Recentes</h2>
                <div class="events-list" id="eventsList">
                    <div class="event-item">
                        <div class="event-name">Aguardando eventos...</div>
                        <div class="event-data">O sistema est√° monitorando atividades</div>
                        <div class="event-time">Agora</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Carregar analytics.js -->
    <script src="/js/analytics.js"></script>

    <script>
        let refreshInterval;
        let debugMode = false;

        // Fun√ß√£o para atualizar dados
        function refreshData() {
            try {
                // Verificar se analytics est√° dispon√≠vel
                if (typeof getAnalyticsSession === 'function') {
                    const sessionData = getAnalyticsSession();
                    const events = getAnalyticsEvents();

                    updateStats(sessionData, events);
                    updateSessionInfo(sessionData);
                    updateEventsList(events);
                    updateStatus();
                } else {
                    showError('Sistema de Analytics n√£o carregado');
                }
            } catch (error) {
                showError('Erro ao atualizar dados: ' + error.message);
            }
        }

        // Atualizar estat√≠sticas
        function updateStats(sessionData, events) {
            document.getElementById('totalEvents').textContent = events.length;
            document.getElementById('sessionTime').textContent = Math.round(sessionData.totalTime / 1000) + 's';
            document.getElementById('scrollDepth').textContent = sessionData.scrollDepth + '%';
        }

        // Atualizar informa√ß√µes da sess√£o
        function updateSessionInfo(sessionData) {
            const sessionInfo = document.getElementById('sessionInfo');
            sessionInfo.innerHTML = `
                <div class="info-item">
                    <div class="info-label">ID da Sess√£o</div>
                    <div class="info-value">${sessionData.sessionId}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">P√°ginas Visualizadas</div>
                    <div class="info-value">${sessionData.pageViews}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Tempo Total</div>
                    <div class="info-value">${Math.round(sessionData.totalTime / 1000)}s</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Profundidade M√°xima</div>
                    <div class="info-value">${sessionData.scrollDepth}%</div>
                </div>
            `;
        }

        // Atualizar lista de eventos
        function updateEventsList(events) {
            const eventsList = document.getElementById('eventsList');

            if (events.length === 0) {
                eventsList.innerHTML = `
                    <div class="event-item">
                        <div class="event-name">Nenhum evento capturado</div>
                        <div class="event-data">Aguarde intera√ß√µes do usu√°rio</div>
                        <div class="event-time">Agora</div>
                    </div>
                `;
                return;
            }

            // Mostrar √∫ltimos 20 eventos
            const recentEvents = events.slice(-20).reverse();
            eventsList.innerHTML = recentEvents.map(event => {
                const eventClass = getEventClass(event.name);
                return `
                    <div class="event-item ${eventClass}">
                        <div class="event-name">${event.name}</div>
                        <div class="event-data">${JSON.stringify(event.data, null, 2)}</div>
                        <div class="event-time">${new Date(event.timestamp).toLocaleString()}</div>
                    </div>
                `;
            }).join('');
        }

        // Obter classe CSS para evento
        function getEventClass(eventName) {
            if (eventName.includes('error') || eventName.includes('fail')) return 'error';
            if (eventName.includes('warning') || eventName.includes('warn')) return 'warning';
            return '';
        }

        // Atualizar status
        function updateStatus() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');

            const gtmStatus = typeof dataLayer !== 'undefined';
            const ga4Status = typeof gtag !== 'undefined';

            if (gtmStatus && ga4Status) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'Online';
            } else if (gtmStatus || ga4Status) {
                statusIndicator.className = 'status-indicator status-warning';
                statusText.textContent = 'Parcial';
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'Offline';
            }
        }

        // Limpar dados
        function clearData() {
            if (confirm('Tem certeza que deseja limpar todos os dados?')) {
                if (typeof clearAnalyticsSession === 'function') {
                    clearAnalyticsSession();
                }
                refreshData();
            }
        }

        // Exportar dados
        function exportData() {
            try {
                const sessionData = getAnalyticsSession();
                const events = getAnalyticsEvents();

                const exportData = {
                    session: sessionData,
                    events: events,
                    exportedAt: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                    type: 'application/json'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `analytics-export-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            } catch (error) {
                showError('Erro ao exportar dados: ' + error.message);
            }
        }

        // Toggle debug mode
        function toggleDebug() {
            debugMode = !debugMode;
            if (typeof AnalyticsConfig !== 'undefined') {
                AnalyticsConfig.debug = debugMode;
            }
            console.log('Debug mode:', debugMode ? 'ON' : 'OFF');
        }

        // Mostrar erro
        function showError(message) {
            console.error(message);
            // Aqui voc√™ pode adicionar uma notifica√ß√£o visual
        }

        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();

            // Atualizar a cada 5 segundos
            refreshInterval = setInterval(refreshData, 5000);

            console.log('üìä Dashboard Analytics inicializado');
        });

        // Limpar interval ao sair
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>

</html>